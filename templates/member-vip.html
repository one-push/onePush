{% extends 'base.html' %}
{% load staticfiles %}

{% block main-big-title %}
{% endblock %}


{% block main-body %}
    <div class="container member-container clearfix">
			<div class="member-aside fl">
				<div class="head-portrait">
					<img src="{{ user_info.head_img }}" />
					<i class="grade"></i>
					<div class="name">{{ user.username }}</div>
					<p class="declaration">经验值<span>菜鸟</span>35积分<a href=""
                    title="海淘那些事： 发布篇原创文章 一次25分 （达人／普通会员均可）
创建一次交易记录：一次15分 （达人会员创建，邀请普通会员（买方）确认）
达人工作台：发布一次 5分（仅限达人会员）
我要我要的： 发布一次 5分 （达人／普通会员均可）
说说谁有理中：点击支持任何一方一次 3个分
在任何地方发表评论：一次3分 （达人／普通会员均可）
在任何地方点 赞 或 倒： 一次1分 （达人／普通会员均可）">积分说明</a></p>
					<div class="credit">
						<div class="stars">
							<span></span>
							<span></span>
							<span></span>
							<span></span>
							<span></span>
							<i style="width:80%"></i>
						</div>
						<em>80%（靠谱度）</em>
					</div>
				</div>
				<div class="btns">
					<a href="#" class="fans">评价({{ reply_count }})</a>
{#					<a href="#" class="fabulous"><i></i>(3)</a>#}
{#					<a href="#" class="fabulous-no"><i></i>(5)</a>#}
					<a href="#" class="follow">关注({{ attention_count }})</a>
					<a href="#" class="collection">收藏({{ favorite_count }})</a>
				</div>
				<a href="/sign/out" ><button class="sign-out">退出登录</button></a>
				<div class="items">
					<div class="col">
						<div class="title">擅长品类</div>
						<div class="desc">{{ user_info.goods_text }}</div>
					</div>
					<div class="col">
						<div class="title">产品来源</div>
						<div class="desc">{{ user_info.source_text }}</div>
					</div>
					<div class="col">
						<div class="title">供货形式</div>
						<div class="desc">{{ user_info.delivery_text }}</div>
					</div>
					<div class="col">
						<div class="title">服务内容</div>
						<div class="desc">{{ user_info.service_text }}</div>
					</div>
				</div>
			</div>

			<div class="member-cont fr">
				<div class="member-tab-title">
					<a href="javascript:;" class="active">服务详情</a>
					<a href="javascript:;">发布记录({{ blog_count }}条)</a>
					<a href="javascript:;">交易记录({{ trade_count }}条)</a>
					<a href="javascript:;">说理记录({{ theory_count }}条)</a>
				</div>
				<div class="member-tab-cont m-table">
					<div class="member-tab-item tab-details">
						网站： {{ user_info.www }}‍　<br/>
						客服邮箱：{{ user_info.email }}<br/>
						客服微信号：{{ user_info.wx }}<br/>
						客服QQ号：{{ user_info.qq }}<br/>
						详情介绍：<br/>
						{{ user_info.desc }}
					</div>
					<div class="member-tab-item tab-transactionRecord hide">
						<a href="/blogs/deploy" class="btn-add">新发布</a>
						<table>
							<thead>
								<tr>
									<th>顺序</th>
									<th>日期</th>
									<th>板块</th>
									<th>标题</th>
									<th>详情</th>
								</tr>
							</thead>
							<tbody>
								{% for item in blogs %}
                                <tr>
                                    <td>{{ item.id }}</td>
                                    <td>{{ item.created_at }}</td>
                                    <td>{{ item.block }}</td>
                                    <td>{{ item.title }}</td>
                                    <td class="red"><a href="/blogs/block/{{ item.id }}">查看详情</a></td>
                                </tr>
                                {% endfor %}
							</tbody>
						</table>
					</div>

					<div class="member-tab-item tab-transactionRecord hide">
						<form method="post", action="/blogs/trade">
                        <div class="form">
							<div class="form-item">
								<label>日期</label>
								<input type="date" placeholder="请输入日期" id="trade-date" name="date">
							</div>
							<div class="form-item">
								<label>买方</label>
								<input type="text" placeholder="请输入买方账号" id="trade-buyer" name="buyer">
							</div>
							<div class="form-item">
								<label>交易金额RMB</label>
								<input type="text" placeholder="请输入交易今额" id="trade-amount" name="amount">
							</div>
							<div class="form-item">
								<label>交易内容</label>
								<input type="text" placeholder="请输入交易内容" id="trade-content" name="content">
							</div>
							<div class="form-item">
								<label>首付款截图</label>
                                <img id="trade-img"/>
                                <input type="hidden" id="trade-img-url" name="img">
                                <input type="hidden" id="trade-id" name="id">
                                <input type="hidden" id="trade-method" name="method" value="" />
								<div class="btn-upload" id="uploadForm">
                                    <input type="file" id="trade-file"  name="file" onchange="uploadFile()">
                                    <span>上传图片</span>
								</div>
							</div>
						</div>
						<div class="form-btn">
							<button type="submit" class="btn">创建新交易</button>
						</div>
						</form>
                        <table class="tb">
							<thead>
								<tr>
									<th>日期</th>
									<th>买方</th>
									<th>交易金额RMB</th>
									<th>交易内容</th>
									<th>首付款截图</th>
									<th>状态</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody>
                                {% for item in trades %}
                                <tr>
                                    <td>{{ item.date_text }}</td>
                                    <td>{{ item.buyer_name }}</td>
                                    <td>{{ item.amount }}</td>
                                    <td>{{ item.content }}</td>
                                    <td><img src="{{ item.img }}" /></td>
                                    {% if item.status == '已确认'  %}
                                        <td class="red">{{ item.status }}</td>
                                        <td class="red"><a href="/blogs/trade/{{ item.id }}">发起说理</a></td>
                                    {% else %}
                                        <td class="green">{{ item.status }}</td>
                                        <td class="green"><a onClick="updateTrade({{ item.id }}, '{{ item.date }}', '{{ item.buyer_name }}', '{{ item.amount }}', '{{ item.content }}', '{{ item.img }}')">修改</a></td>
                                    {% endif %}
                                </tr>
                                {% endfor %}
							</tbody>
						</table>
					</div>

					<div class="member-tab-item tab-transactionRecord hide">

						<table>
							<thead>
								<tr>
									<th>顺序</th>
									<th>序号</th>
									<th>主题</th>
									<th>状态</th>
									<th>详情</th>
								</tr>
							</thead>
							<tbody>
								{% for item in theorys %}
                                <tr>
                                    <td>{{ item.id }}</td>
                                    <td>{{ item.code }}</td>
                                    <td>{{ item.title }}</td>
                                    <td>{{ item.status }}</td>
                                    <td class="red"><a href="/blogs/theory/{{ item.id }}">查看详情</a></td>
                                </tr>
                                {% endfor %}
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
{% endblock %}

{% block js-body %}
<script type="text/javascript">

    function uploadFile() {
        var formData = new FormData();
        formData.append('file', $('#trade-file')[0].files[0]);
        $.ajax({
            type:'POST',
            url: '/image_upload',
            cache: false,
            data: formData,
            processData: false,
            contentType: false,
            success: function(data){
                var url = '/media/' + data.url;
                $("#trade-img").attr("src", url);
                $("#trade-img-url").val(url);
            },
        })
    }

    function createTrade(){

    }

    // 直接传item对象，语法报错
    function updateTrade(id, date, buyer, amount, content, img){
        $("#trade-method").val('put')
        $("#trade-id").val(id);
        $("#trade-date").val(date);
        $("#trade-buyer").val(buyer);
        $("#trade-amount").val(amount);
        $("#trade-content").val(content);
        $("#trade-img-url").val(img);
        $("#trade-img").attr("src", img);
    }
</script>
{% endblock %}